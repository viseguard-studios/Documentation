@startuml
actor Tester as Tester<<SpaceShip>>
participant recipe as recipe <<SpaceStationRecipe>>
participant s as s <<SpaceShip>>
participant inventory as inventory <<Inventory>>
collections item as item <<Item>>
participant asteroid as asteroid <<Asteroid>>
participant inv as inv <<Inventory>>
collections aItem as aItem <<Item>>
collections rItem as rItem <<Item>>
participant station as station <<SpaceStation>>
participant scene as scene <<Scene>>
participant mgr as mgr <<GameManager>>


title SpaceShip can craft space station

Tester-> recipe++: Craft(s)

recipe -> s++: GetAsteroid()
s --> recipe--: a

recipe -> s++: GetInventory()
s --> recipe--: inv

group loop: input check[for each rItem in recipe.input]

    recipe -> inventory++: RemoveItem(rItem)

    group loop: satisfies check [for each item in items] 
         inventory -> item++: Satisfies(rItem)
         item --> inventory--: x
        group opt [if x>0]
            inventory -> item++: Reduce(x)
            item --> inventory--:
        end
    end

    inventory-->recipe--: x

    recipe -> rItem++: Reduce(x)
    rItem --> recipe--: 

    group opt [not satisfied]
        recipe -> asteroid++: GetInventory()
        asteroid --> recipe--: inv

        recipe -> inv++: RemoveItem(rItem)

            group loop: satisfies check [for each item in aItems] 
                 inv -> aItem++: Satisfies(rItem)
                 aItem --> inv--: y
                group opt [if y>0]
                      inv -> aItem++: Reduce(y)
                      aItem --> inv--:
                 end
           end
        inv--> recipe--: y
    end
end
recipe -> recipe++: MakeResult(s)

recipe --> station: <<create>> SpaceStation(asteroid)
station -> station++:  SpaceStation(asteroid)

note right
konstruktorhívás belseje
end note

station -> asteroid++: AddBuilding(station)
asteroid --> station--: 

station -> asteroid++: GetScene()
asteroid --> station--: scene

station -> scene++: GetManager()
scene --> station--: mgr

station -> mgr++: EndGame()
mgr --> station--: 

station-->recipe--:


recipe --> Tester: 

caption A recept levonja a nyersanyagokat a megfelelő helyekről (telepes vagy aszteroida raktárából, kapacitástól függően), \n majd elkészíti az űrállomást és elhelyezi a megfelelő aszteroidán. Az űrállomás konstruktora jelzi a játékmenedzsernek, hogy felépült az űrállomás, ami a játék végét jelenti. 

@enduml